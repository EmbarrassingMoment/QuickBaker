# QuickBaker

QuickBakerは、Unreal Engine 5.5以降向けのマテリアル表現（エミッシブ/ファイナルカラー）を静的テクスチャにベイクするためのシンプルで高速なツールです。

## アーキテクチャ

QuickBakerプラグインは、単一責任の原則（SRP）に従って構成されており、保守性と拡張性を確保しています。

### クラス図 / 責務

- **FQuickBakerModule**: モジュールのライフサイクル（起動/終了）を処理し、エディタタブを登録し、メニューエントリを管理します。
- **FQuickBakerSettings**: ベイク操作の設定（解像度、出力タイプ、パスなど）を保持する純粋なデータ構造体（struct）です。検証ロジックを含みます。
- **FQuickBakerCore**: ベイクプロセスのコアビジネスロジックを含みます。
  - レンダーターゲットのセットアップ。
  - 選択されたマテリアルのレンダリング。
  - テクスチャアセット（`.uasset`）の作成とトランザクションの処理。
- **FQuickBakerExporter**: レンダーターゲットを外部ファイル（PNG、EXR）にエクスポートするための専用クラスです。イメージラッパーの相互作用とファイルシステムの書き込みを処理します。
- **SQuickBakerWidget**: Slate UIウィジェットです。
  - すべてのUI要素（コンボボックス、ボタン、サムネイル）を管理します。
  - ユーザー操作を処理します。
  - UI状態から `FQuickBakerSettings` を構築し、`FQuickBakerCore` に実行を委譲します。

## 概要
QuickBakerは、動的なマテリアルを静的なテクスチャに変換するプロセスを効率化します。複雑なノイズパターン、SDF（Signed Distance Fields）、プロシージャルテクスチャのベイクが必要な場合でも、QuickBakerはセットアップ、レンダリング、保存のプロセスをワンクリックで処理します。テクスチャアセット（`.uasset`）として直接保存するか、PNGやEXRとしてディスクにエクスポートすることが可能です。

## 機能
- **マルチフォーマット対応**:
  - **テクスチャアセット**: コンテンツブラウザに直接保存します。
  - **PNG**: ディスクにエクスポート（8bit固定、アルファチャンネルを保持）。
  - **EXR**: ディスクにエクスポート（16bit float固定、リニア）、ハイトマップなどの高精度データに最適です。
- **スマートUI**:
  - **サムネイルプレビュー**: 選択したマテリアルの64x64プレビューを即座に表示します。
  - **自動命名**: `M_` や `MI_` の接頭辞を自動的に `T_` に変換します（例: `M_Noise` -> `T_Noise`）。
  - **動的設定**: 「ビット深度」ドロップダウンは、無効な設定を防ぐために選択した出力タイプに基づいて自動的にロックされます。
- **ワークフローの効率化**:
  - **フォルダの自動作成**: 保存先フォルダが存在しない場合、自動的に作成されます。
  - **コンテキストに応じた参照**: アセットの場合はコンテンツブラウザを、外部エクスポートの場合はOSのファイルダイアログを開きます。
  - **柔軟な設定**: 64から8192までの解像度、8/16ビット深度、および様々な圧縮設定（Default, Normalmap, Grayscale, HDR）をサポートします。

## インストール
1. Unreal Engineを閉じます。
2. `QuickBaker` フォルダをUnreal Engineプロジェクトの `Plugins` ディレクトリにコピーします（例: `MyProject/Plugins/QuickBaker`）。
   - `Plugins` フォルダが存在しない場合は、プロジェクトのルートディレクトリに作成してください。
3. プロジェクトを開きます。
4. **Edit > Plugins** からプラグインが有効になっていることを確認します（通常はデフォルトで有効になります）。

## 使い方
1. **Tools > QuickBaker > Quick Baker** からツールを開きます。
2. **Material (マテリアル) の選択**: ベイクしたいマテリアルまたはマテリアルインスタンスを選択します。サムネイルプレビューが表示されます。
   - *注: ツールはマテリアルの「ファイナルカラー」（エミッシブ）出力をキャプチャします。*
3. **Output Type (出力タイプ) の選択**:
   - **Asset**: プロジェクトに `.uasset` を保存します。
   - **PNG** または **EXR**: コンピュータに画像ファイルを保存します。
4. **設定の構成**:
   - **Resolution (解像度)**: 64x64 から 8192x8192 の間でサイズを選択します。
   - **Bit Depth (ビット深度)**: 8bit または 16bit を選択します（PNG/EXRの場合はロックされます）。スムーズなグラデーションには16bitが推奨されます。
   - **Compression (圧縮)**: テクスチャ圧縮を選択します（例: ノーマルマップの場合は `TC_Normalmap`）。
5. **Output Path (出力パス) の設定**:
   - **Browse** をクリックして保存先フォルダを選択します。
   - **Output Name (出力名)** は自動的に生成されますが、カスタマイズも可能です。
6. **Bake Texture** をクリックします。

## 要件
- Unreal Engine 5.5 以降。

## FAQ（よくある質問）

### Q: PNGエクスポートはアルファ/透明度を保持しますか？
**A:** はい。PNGエクスポートは、マテリアルのEmissive Color出力からアルファチャンネルを保持します。マテリアルが透明度情報を出力する場合（例：OpacityピンをEmissiveに接続）、PNG ファイルに保存されます。

**ヒント:**
- 透明度をベイクするには: Opacity/Mask出力をEmissive ColorのAlphaチャンネルに接続してください。
- PNGは完全な8bitアルファ（0-255）をサポートし、滑らかな透明度グラデーションが可能です。
- より高精度なアルファが必要な場合は、EXRエクスポート（16bit float）を使用してください。

### Q: ベイクしたテクスチャが真っ黒になります。何が問題ですか？
**A:** QuickBakerはマテリアルの**ファイナルカラー（エミッシブ）**出力をキャプチャします。マテリアルのEmissive Colorピンに何も接続されていない場合、出力は黒になります。

**解決方法:**
- **Unlitマテリアルを使用**: UnlitマテリアルはEmissive Color入力のみを使用するため、ベイクに最適です。
- **エミッシブに接続**: Litマテリアル（DefaultLit、Subsurfaceなど）を使用する場合、目的の出力を**Emissive Color**ピンに接続してください。
- **セットアップ例**:
  - ノイズテクスチャの場合: ノイズを直接Emissive Colorに接続。
  - カラー/アルベドの場合: Base ColorをEmissive Colorに接続。
  - ノーマルマップの場合: このツールは適していません（専用のノーマルマップベイカーを使用してください）。

### Q: QuickBakerに適したテクスチャタイプは？
**A:** QuickBakerは以下のベイクに優れています:
- プロシージャルノイズパターン
- Signed Distance Fields (SDF)
- グラデーションテクスチャ
- 数学的/計算的なテクスチャ
- 色を出力するあらゆるMaterial Expression

ライティング、シャドウ、ノーマルマップのベイクには**設計されていません**。

### Q: 8bitと16bitの違いは何ですか？
**A:**
- **8bit**: 標準的な色精度。通常のテクスチャに使用。
- **16bit**: 高精度。ノイズテクスチャやSDFには**強く推奨**。カラーバンディング/ポスタリゼーションを防ぎます。

注意: PNGエクスポートは8bitに固定、EXRエクスポートは16bit floatに固定されます。

## ライセンス
このプロジェクトはMITライセンスの下で提供されています。
